<%- model_class = Instance -%>
<div class=" viewInstance">
  <div class="headerWrapper clearfix">
    <h1><%=t '.title', :default => model_class.model_name.human.titleize %></h1>
    <%= link_to "<i class='icon-arrow-left icon-white'></i> BACK".html_safe,
                request.referrer, :class => 'customBtn back' %>
  </div>

  <dl class="dl-horizontal">


    <dt><strong><%= model_class.human_attribute_name(:flavor_id) %>:</strong></dt>
    <dd><%= @instance.flavor_id %></dd>
    <dt><strong><%= model_class.human_attribute_name(:state) %>:</strong></dt>
    <dd> <div id="instance_state"><%= @instance.state %></div></dd>
    <dt><strong><%= model_class.human_attribute_name(:name) %>:</strong></dt>
    <dd><%= best_in_place @instance, :name %></dd>
    <dt><strong><%= model_class.human_attribute_name(:private_ip) %>:</strong></dt>
    <dd><%= @instance.private_ip %></dd>
    <dt><strong><%= model_class.human_attribute_name(:public_ip) %>:</strong></dt>
    <dd><%= @instance.public_ip %></dd>
  </dl>
  <% if @instance.state.to_s.downcase == "building" %>


      <div class="progressWrapper">
        progress :
        <div class="progress progress-striped active">
          <div class="bar" style="width: <%= @instance.progress%>%;"></div>
        </div>
      </div>

  <% end %>
  <div class="form-actions">
    <ul>
      <% if @provider.type.to_s.downcase == "aws"%>
      <li>
        <%= link_to "Start",
                    instance_path(@instance),
                    :method => 'delete',
                    :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                    :class => 'btn btn-success' %>
      </li>
      <li>
        <%= link_to "Stop",
                    cloud_provider_instance_stop_path(@provider,@instance),
                    :method => 'delete',
                    :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                    :class => 'btn btn-danger' %>
      </li>
      <% end %>
      <li>
        <%= link_to "Resize",
                    instance_path(@instance),
                    :method => 'delete',
                    :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                    :class => 'btn customBtn' %>
      </li>
      <li>
        <%= link_to "Reboot",
                    instance_path(@instance),
                    :method => 'delete',
                    :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                    :class => 'btn btn-inverse' %>
      </li>
      <li>
        <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                    instance_path(@instance),
                    :method => 'delete',
                    :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                    :class => 'btn btn-danger' %>
      </li>
    </ul>

  </div>
</div>
<script>
    //Call the yourAjaxCall() function every 1000 millisecond
    setInterval("yourAjaxCall()",1000);
    function yourAjaxCall(){
        if($("#instance_state").text().toLowerCase() == "building")
        {
            $.ajax({
                url:"/instances/<%= @instance.id%>/instance_status",
                type: "GET",
                async: false,
                dataType:"json",

                complete:function(resp,type)
                {

                    response = JSON.parse(resp.responseText);
                    $("#instance_state").text(response.state);
                    $(".bar").css("width",response.progress +"%");
                    if(response.state.toLowerCase() == "active")
                    {
                        $(".progressWrapper").hide();
                    }
                }

            });
        }

    }
</script>